### 第一次部署上线的问题记录

- 才知道在反向代理的使用中，用户真正访问的并非是直接的服务器，而是反向代理服务器

- 发现一个vscode的插件Live Server，可以模拟前端代码部署上线后的情况

- 将前端代码上线在vercel后（想要将后端部署在腾讯云服务器），发现访问前端要开代理，但是开了代理却访问不了腾讯云服务了（难受😫

- 最后iindex项目部署还是选择了腾讯云的免费服务器，真是走了好多坑

- 首先将在服务器中部署起来要注意的点（使用的是**宝塔**）：

  - 有用到数据库诸如mysql，或者redis这样的服务的后端，要先把这些东西在服务器中配置好，数据库要先创好
  - 在代码中也需要配置好对应的服务地址、账号、密码等
  - 不要尝试使用浏览器直接去访问接口地址来进行接口的测试啊啊啊！！！（因为默认使用的是`GET`方法），对于需要`post`请求的接口就直接报405/404了
  - 因此可以使用国内像`apifox`或者是`apipost`这样的工具进行测试接口
  - 然后就是nginx的配置

  ![71470622330](杂记.assets/1714706223308.png)

  - 因为接口的前缀都是`/api`，因此配置nginx只要匹配到`/api`就直接转发到后端运行端口5000的`/api`下即可
  - 因为前端打包后跑在服务器的3005端口，如果不想要`服务器外网:3005`这样访问的话，可以配置nginx为

  ```js
  location / {
      proxy_pass http://127.0.0.1:3005
  }
  ```

  - 还有出现什么问题则及时查看后端日志
  - 前端最后出现的问题是我直接在prod环境下将axios的基地址直接设置为了`服务器外网ip/api`，但是实际上应该设置为`http://服务器外网ip/api`，怪不得一直访问不到接口404（在浏览器可以直接输入IP地址访问网站是因为浏览器会自动为我们补全，而在axios中如果没有明确协议，axios则不知道使用什么协议）




### 数据库建表关系

1、注意事项：

1)、先完成实体的关系模型(表)，确定实体的主码(尽量单列做主码)

2)、联系的转换：

**①1:1的联系**

**联系合并到某个1端，并在该表中增加另一个实体的码(作为外码，不作为主属性！)，以及添加联系本身的属性。**

**② 1:n的联系**

**合并到n端对应的表中，将1端的码添加到n端的表(作为外码，不作为主属性！)，以及添加联系本身的属性。**

**③m:n的联系**

**必须增加一个新表，新表的码至少由联系两端实体的码组合而成，同时增加相关的联系属性(如有时间等辅助标识唯一属性，一般应作为主属性)。**

3)、课本P232，1：1，1：n联系时，把转换新的关系模式打叉，以后工作时除非很特殊的场景，都不要转换为新的表。ER图的设计虽然理论上是最简关系，但关系型数据库的缺点之一就是表相对较多，多表查询可能时延较大，商用时还可能根据性能降低范式合表（只要业务模型能规避低范式的增删改问题即可）。

```json
db.col.insert(
    {
        username: 'zwf021123', 
        password: '123456',
        enail: '123456@163.com',
        status: '0',
        createTime: '',
        updateTime: '',
        bindingSpace: {
            "space": {
                "/": {
                    "name": "/",
                    "dir": "/",
                    "type": "dir"
                },
                "/baidu": {
                    "dir": "/",
                    "link": "http://bud.com",
                    "name": "baidu",
                    "type": "link"
                },
                "/newtest": {
                    "dir": "/",
                    "name": "newtest",
                    "type": "dir"
                },
                "/newtest/sougou": {
                    "dir": "/newtest",
                    "link": "http://dklaj",
                    "name": "sougou",
                    "type": "link"
                },
                "/newtest/baidu": {
                    "dir": "/newtest",
                    "link": "http://bud.com",
                    "name": "baidu",
                    "type": "link"
                },
                "/xxx": {
                    "dir": "/",
                    "name": "xxx",
                    "type": "dir"
                }
                },
                "currentDir": "/xxx"
                }
            }
    }
)
```



```json
db.col.insert(
    {
        username: 'zwf021123', 
        password: '123456',
        enail: '123456@163.com',
        status: '0',
        createTime: '',
        updateTime: '',
        bindingSpace: "idksladjklasjdklwj"
    }
)

{
    _id:"idksladjklasjdklwj",
    "space": {
        "/": {
            "name": "/",
            "dir": "/",
            "type": "dir"
        },
        "/baidu": {
            "dir": "/",
            "link": "http://bud.com",
            "name": "baidu",
            "type": "link"
        },
        "/newtest": {
            "dir": "/",
            "name": "newtest",
            "type": "dir"
        },
        "/newtest/sougou": {
            "dir": "/newtest",
            "link": "http://dklaj",
            "name": "sougou",
            "type": "link"
        },
        "/newtest/baidu": {
            "dir": "/newtest",
            "link": "http://bud.com",
            "name": "baidu",
            "type": "link"
        },
        "/xxx": {
            "dir": "/",
            "name": "xxx",
            "type": "dir"
        }
     },
    "currentDir": "/xxx"
}
```

- 接口	
  - insert(新用户注册时)
  - update(在本地修改完数据后再一起更新，是整体还是局部？？？)
  - delete(用户注销时)
  - select(用户登录成功后以用户id为参数查询对应空间数据)




### iindex问题与思考


登录成功之后再获取对应空间顺序（如何保证这个执行顺序？？？）

sequilize的关联导致多一个字段（挂起

在用户未登录的时候想要操作空间系统需要先登录

新增注销账户功能（挂起

用户输入密码时使用星号隐藏输入内容（在命令中定义一个字段用于判断该选项的输入值是否需要隐藏，在监听input新增一个函数，判断全局是否匹配到命令，检索该命令中是否存在需要隐藏的option，如果上述条件都满足才执行该函数，如果当前输入的option匹配到了需要隐藏的option，那么开始存储（一个全局变量）用户实际输入，但是显示的部分为星号，此后在执行命令时再将隐藏的部分替换为真正的值（注意所有的命令检索都需要使用递归，因为存在子命令的情况）

出现输入框被disabled的情况

 没有需要隐藏的内容(包括子命令)（新建一个函数递归判断）

 得到所有需要隐藏的选项（新建一个函数递归获取

修复hint Hook在父子命令未更新command.value的情况

~~前端异常处理~~

~~为什么要自己定义状态码~~

~~请求用户的space集成到space的action中~~

~~检查$subscribe的监听成功完全度~~

~~递归移动目录有误（并非有误，而是存在语义问题，即需要新增一个option判断用户是否需要将当前指定的目录也一起复制过去，还是只是复制目录下的内容）~~

~~需要新增不允许update目录时传入link~~

~~能否在首次页面加载后不请求updateSpace~~(定义一个全局变量判断)

~~退出登录同时需要清空space数据~~

~~用户需要先退出当前账号才能登入新账号~~

~~判断是否是刷新导致的state改变+是否是logout+login导致的state改变，则不发送请求update数据（目前如果退出登录，因为退出登录先执行了，所以后台的session已经delete，因此update的space失败）~~