### 第一次部署上线的问题记录

- 才知道在反向代理的使用中，用户真正访问的并非是直接的服务器，而是反向代理服务器

- 发现一个vscode的插件Live Server，可以模拟前端代码部署上线后的情况

- 将前端代码上线在vercel后（想要将后端部署在腾讯云服务器），发现访问前端要开代理，但是开了代理却访问不了腾讯云服务了（难受😫

- 最后iindex项目部署还是选择了腾讯云的免费服务器，真是走了好多坑

- 首先将在服务器中部署起来要注意的点（使用的是**宝塔**）：

  - 有用到数据库诸如mysql，或者redis这样的服务的后端，要先把这些东西在服务器中配置好，数据库要先创好
  - 在代码中也需要配置好对应的服务地址、账号、密码等
  - 不要尝试使用浏览器直接去访问接口地址来进行接口的测试啊啊啊！！！（因为默认使用的是`GET`方法），对于需要`post`请求的接口就直接报405/404了
  - 因此可以使用国内像`apifox`或者是`apipost`这样的工具进行测试接口
  - 然后就是nginx的配置

  ![71470622330](杂记.assets/1714706223308.png)

  - 因为接口的前缀都是`/api`，因此配置nginx只要匹配到`/api`就直接转发到后端运行端口5000的`/api`下即可
  - 因为前端打包后跑在服务器的3005端口，如果不想要`服务器外网:3005`这样访问的话，可以配置nginx为

  ```js
  location / {
      proxy_pass http://127.0.0.1:3005
  }
  ```

  - 还有出现什么问题则及时查看后端日志
  - 前端最后出现的问题是我直接在prod环境下将axios的基地址直接设置为了`服务器外网ip/api`，但是实际上应该设置为`http://服务器外网ip/api`，怪不得一直访问不到接口404（在浏览器可以直接输入IP地址访问网站是因为浏览器会自动为我们补全，而在axios中如果没有明确协议，axios则不知道使用什么协议）




### 数据库建表关系

1、注意事项：

1)、先完成实体的关系模型(表)，确定实体的主码(尽量单列做主码)

2)、联系的转换：

**①1:1的联系**

**联系合并到某个1端，并在该表中增加另一个实体的码(作为外码，不作为主属性！)，以及添加联系本身的属性。**

**② 1:n的联系**

**合并到n端对应的表中，将1端的码添加到n端的表(作为外码，不作为主属性！)，以及添加联系本身的属性。**

**③m:n的联系**

**必须增加一个新表，新表的码至少由联系两端实体的码组合而成，同时增加相关的联系属性(如有时间等辅助标识唯一属性，一般应作为主属性)。**

3)、课本P232，1：1，1：n联系时，把转换新的关系模式打叉，以后工作时除非很特殊的场景，都不要转换为新的表。ER图的设计虽然理论上是最简关系，但关系型数据库的缺点之一就是表相对较多，多表查询可能时延较大，商用时还可能根据性能降低范式合表（只要业务模型能规避低范式的增删改问题即可）。

```
db.col.insert(
    {
        username: 'zwf021123', 
        password: '123456',
        enail: '123456@163.com',
        status: '0',
        createTime: '',
        updateTime: '',
        bindingSpace: {
            "space": {
                "/": {
                    "name": "/",
                    "dir": "/",
                    "type": "dir"
                },
                "/baidu": {
                    "dir": "/",
                    "link": "http://bud.com",
                    "name": "baidu",
                    "type": "link"
                },
                "/newtest": {
                    "dir": "/",
                    "name": "newtest",
                    "type": "dir"
                },
                "/newtest/sougou": {
                    "dir": "/newtest",
                    "link": "http://dklaj",
                    "name": "sougou",
                    "type": "link"
                },
                "/newtest/baidu": {
                    "dir": "/newtest",
                    "link": "http://bud.com",
                    "name": "baidu",
                    "type": "link"
                },
                "/xxx": {
                    "dir": "/",
                    "name": "xxx",
                    "type": "dir"
                }
                },
                "currentDir": "/xxx"
                }
            }
    }
)
```



```json
db.col.insert(
    {
        username: 'zwf021123', 
        password: '123456',
        enail: '123456@163.com',
        status: '0',
        createTime: '',
        updateTime: '',
        bindingSpace: "idksladjklasjdklwj"
    }
)

{
    _id:"idksladjklasjdklwj",
    "space": {
        "/": {
            "name": "/",
            "dir": "/",
            "type": "dir"
        },
        "/baidu": {
            "dir": "/",
            "link": "http://bud.com",
            "name": "baidu",
            "type": "link"
        },
        "/newtest": {
            "dir": "/",
            "name": "newtest",
            "type": "dir"
        },
        "/newtest/sougou": {
            "dir": "/newtest",
            "link": "http://dklaj",
            "name": "sougou",
            "type": "link"
        },
        "/newtest/baidu": {
            "dir": "/newtest",
            "link": "http://bud.com",
            "name": "baidu",
            "type": "link"
        },
        "/xxx": {
            "dir": "/",
            "name": "xxx",
            "type": "dir"
        }
     },
    "currentDir": "/xxx"
}
```

- 接口	
  - insert(新用户注册时)
  - update(在本地修改完数据后再一起更新，是整体还是局部？？？)
  - delete(用户注销时)
  - select(用户登录成功后以用户id为参数查询对应空间数据)





登录成功之后再获取对应空间顺序（如何保证这个执行顺序？？？）

